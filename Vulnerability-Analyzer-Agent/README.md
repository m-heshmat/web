# Vulnerability Analyzer Agent

The **Vulnerability Analyzer Agent** is a FastAPI-based application designed to analyze and extract structured vulnerability details from unstructured text. It leverages advanced language models to provide actionable insights into web application vulnerabilities, including remediation steps, severity levels, and more.

---

## Features

- **Structured Vulnerability Extraction**: Converts unstructured vulnerability descriptions into structured JSON adhering to a Pydantic schema.
- **Customizable Language Model**: Supports integration with OpenAI-compatible models via LangChain.
- **FastAPI Integration**: Provides a RESTful API for easy interaction.
- **Dockerized Deployment**: Fully containerized for seamless deployment.

---

## Project Structure
```
├── app/
│   ├── agents/          # Contains the LangChain-based vulnerability agent
│   ├── prompts/         # Prompt templates for the language model
│   ├── schemas/         # Pydantic schemas for structured data
│   ├── app.py           # FastAPI application entry point
│   └── requirements.txt # Python dependencies
├── Dockerfile           # Docker configuration
├── commands.txt         # Useful commands for building and running the app
├── .dockerignore        # Files to exclude from Docker builds
├── .gitignore           # Files to exclude from Git
└── README.md            # Project documentation
```

---

## Installation

### Prerequisites

- Python 3.12 or higher
- Docker (optional, for containerized deployment)

### Local Setup

1. Clone the repository:
    ```bash
    git clone https://github.com/your-repo/vulnerability-analyzer-agent.git
    cd vulnerability-analyzer-agent
    ```

2. Install dependencies:
    ```bash
    pip install -r app/requirements.txt
    ```

3. Set environment variables: Create a `.env` file in the `app/` directory with the following variables:
    ```bash
    API_KEY=your_openrouter_api_key
    MODEL=meta-llama/llama-4-maverick:free
    BASE_URL=https://openrouter.ai/api/v1
    TEMPERATURE=0.6
    ```

4. Run the application:
    ```bash
    python app/app.py
    ```

5. Access the API at `http://localhost:3000`.

## API Endpoints
POST `/vulns_details`

Extracts structured vulnerability details from a list of unstructured vulnerability descriptions.

### Request Body (example)
```json
{
  "vulnerabilities": [
    "[swagger-api] [http] [info] http://localhost:3000/api-docs/swagger.json [paths=\"/api-docs/swagger.json\"]",
    "[http-missing-security-headers:strict-transport-security] [http] [info] http://localhost:3000"
  ]
}
```

### Response
```json
{
  "vulnerabilities": [
    {
        "description": "The API documentation is accessible via the provided URL, potentially exposing sensitive information about the API endpoints and structure.",
        "remediation": "Restrict access to API documentation by implementing proper authentication and authorization mechanisms.",
        "category": "API Documentation Exposure",
        "severity": "medium",
        "learn_more_url": "https://owasp.org/www-project-api-security/"
    },
    {
        "description": "The HTTP response is missing the Strict-Transport-Security header, making it vulnerable to man-in-the-middle attacks and potentially allowing an attacker to downgrade the connection to HTTP.",
        "remediation": "Configure the server to include the Strict-Transport-Security header in its HTTP responses with a sufficient max-age directive.",
        "category": "Missing Security Header",
        "severity": "high",
        "learn_more_url": "https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security"
    }
  ]
}
```

## Docker Deployment
1. Clone the repository:
    ```bash
    git clone https://github.com/your-repo/vulnerability-analyzer-agent.git
    cd vulnerability-analyzer-agent
    ```

2. Build the Docker image:
    ```bash
    docker build -t vuln-analyzer-agent:1.0 .
    ```

3. Run the container:
    ```bash
    docker run -d -p 3000:3000 \
    --name vulns_agent \
    -e API_KEY="your_openrouter_key" \
    -e MODEL="meta-llama/llama-4-maverick:free" \
    -e BASE_URL="https://openrouter.ai/api/v1" \
    -e TEMPERATURE="0.6" \
    vuln-analyzer-agent:1.0
    ```

4. Access the API at `http://localhost:3000`.

## Testing
You can test the API using `httpie` or `curl`:

Using `httpie`
```bash
http POST http://localhost:3000/vulns_details \
vulnerabilities:='[
    "[swagger-api] [http] [info] http://localhost:3000/api-docs/swagger.json [paths=\"/api-docs/swagger.json\"]",
    "[http-missing-security-headers:strict-transport-security] [http] [info] http://localhost:3000"
]'
```

Using `curl`
```bash
curl -X POST http://localhost:3000/vulns_details \
  -H "Content-Type: application/json" \
  -d '{
        "vulnerabilities": [
            "[swagger-api] [http] [info] http://localhost:3000/api-docs/swagger.json [paths=\"/api-docs/swagger.json\"]",
            "[http-missing-security-headers:strict-transport-security] [http] [info] http://localhost:3000"
        ]
      }'
```