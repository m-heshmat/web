# for docker image build
docker build -t vuln-analyzer-agent:1.0 .


# for runing a container
docker run -d -p 3000:3000 \
    --name vulns_agent \
    -e API_KEY="REPLACE_WITH_OPENROUTER_API_KEY" \
    -e MODEL="meta-llama/llama-4-maverick:free" \
    -e BASE_URL="https://openrouter.ai/api/v1" \
    -e TEMPERATURE="0.6" \
    vuln-analyzer-agent:1.0


# for full system integration dont forget to set a network between containers (not now)
    --net my-network


# for testing example

## using http
http POST http://localhost:3000/vulns_details \
vulnerabilities:='[
  "[swagger-api] [http] [info] http://localhost:3000/api-docs/swagger.json [paths=\"/api-docs/swagger.json\"]",
  "[http-missing-security-headers:strict-transport-security] [http] [info] http://localhost:3000"
]'

## using curl
curl -X POST http://localhost:3000/vulns_details \
  -H "Content-Type: application/json" \
  -d '{
        "vulnerabilities": [
          "[swagger-api] [http] [info] http://localhost:3000/api-docs/swagger.json [paths=\"/api-docs/swagger.json\"]",
          "[http-missing-security-headers:strict-transport-security] [http] [info] http://localhost:3000"
        ]
      }'


## Expected output format
{
  "vulnerabilities": [
    {
      "description": "The API documentation is accessible via the provided URL, potentially exposing sensitive information about the API endpoints and structure.",
      "remediation": "Restrict access to API documentation by implementing proper authentication and authorization mechanisms.",
      "category": "API Documentation Exposure",
      "severity": "medium",
      "learn_more_url": "https://owasp.org/www-project-api-security/"
    },
    {
      "description": "The HTTP response is missing the Strict-Transport-Security header, making it vulnerable to man-in-the-middle attacks and potentially allowing an attacker to downgrade the connection to HTTP.",
      "remediation": "Configure the server to include the Strict-Transport-Security header in its HTTP responses with a sufficient max-age directive.",
      "category": "Missing Security Header",
      "severity": "high",
      "learn_more_url": "https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security"
    }
  ]
}
